{"version":3,"file":"object-3d-material-geometry.abstract.js","sourceRoot":"","sources":["../../../../../../packages/core/src/lib/abstracts/object-3d-material-geometry.abstract.ts"],"names":[],"mappings":"AAAA,OAAO,EAAoB,SAAS,EAAE,KAAK,EAAE,MAAM,eAAe,CAAC;AACnE,OAAO,EAAE,cAAc,EAAE,QAAQ,EAAY,MAAM,OAAO,CAAC;AAE3D,OAAO,EAAE,aAAa,EAAE,MAAM,sBAAsB,CAAC;;AAGrD,MAAM,OAAgB,6BAGpB,SAAQ,aAAsB;IAa9B,IAAI,SAAS,CAAC,CAAY;QACxB,IAAI,CAAC,UAAU,GAAG,CAAC,CAAC;IACtB,CAAC;IAED,kBAAkB;QAChB,IAAI,CAAC,IAAI,EAAE,CAAC;IACd,CAAC;IAES,UAAU;QAClB,IAAI,IAAI,CAAC,SAAS,EAAE,EAAE;YACpB,MAAM,QAAQ,GAAG,IAAI,CAAC,WAAW,EAAE,CAAC;YACpC,MAAM,QAAQ,GAAG,IAAI,CAAC,WAAW,EAAE,CAAC;YAEpC,IAAI,CAAC,uBAAuB,GAAG,IAAI,IAAI,CAAC,UAAU,CAChD,QAAQ,EACR,QAAQ,EACR,GAAG,CAAC,IAAI,CAAC,UAAU,IAAI,EAAE,CAAC,CAC3B,CAAC;YAEF,IACE,IAAI,CAAC,qBAAqB;gBAC1B,uBAAuB,IAAI,IAAI,CAAC,uBAAuB,EACvD;gBACC,IAAI,CAAC,uBAAyC,CAAC,qBAAqB;oBACnE,IAAI,CAAC,qBAAqB,CAAC;aAC9B;YAED,IACE,IAAI,CAAC,qBAAqB;gBAC1B,uBAAuB,IAAI,IAAI,CAAC,uBAAuB,EACvD;gBACC,IAAI,CAAC,uBAAyC,CAAC,qBAAqB;oBACnE,IAAI,CAAC,qBAAqB,CAAC;aAC9B;YAED,IAAI,IAAI,CAAC,SAAS,EAAE;gBAClB,IAAI,CAAC,SAAS,EAAE,CAAC;aAClB;SACF;IACH,CAAC;IAIS,SAAS;QACjB,OAAO,IAAI,CAAC;IACd,CAAC;IAED,IAAI,QAAQ;QACV,OAAO,IAAI,CAAC,uBAAuB,CAAC;IACtC,CAAC;IAEO,WAAW;QACjB,IAAI,IAAI,CAAC,QAAQ,EAAE;YACjB,IACE,CAAC,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,QAAQ,CAAC;gBAC3B,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,YAAY,QAAQ,CAAC;gBACvC,IAAI,CAAC,QAAQ,YAAY,QAAQ,EACjC;gBACA,OAAO,IAAI,CAAC,QAAiC,CAAC;aAC/C;YAED,IAAI,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,QAAQ,CAAC,EAAE;gBAChC,OAAQ,IAAI,CAAC,QAAqB,CAAC,GAAG,CACpC,CAAC,UAAU,EAAE,EAAE,CACb,IAAI,CAAC,cAAc,CAAC,kBAAkB,EAAE,CAAC,SAAS,CAAC,UAAU,CAAC,CACjE,CAAC;aACH;YAED,OAAO,IAAI,CAAC,cAAc,CAAC,kBAAkB,EAAE,CAAC,SAAS,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;SAC1E;QAED,OAAO,SAAS,CAAC;IACnB,CAAC;IAEO,WAAW;QACjB,IAAI,IAAI,CAAC,QAAQ,EAAE;YACjB,IAAI,IAAI,CAAC,QAAQ,YAAY,cAAc,EAAE;gBAC3C,OAAO,IAAI,CAAC,QAAQ,CAAC;aACtB;YAED,OAAO,IAAI,CAAC,cAAc,CAAC,kBAAkB,EAAE,CAAC,gBAAgB,CAC9D,IAAI,CAAC,QAAQ,CACd,CAAC;SACH;QACD,OAAO,SAAS,CAAC;IACnB,CAAC;;2HArGmB,6BAA6B;+GAA7B,6BAA6B;4FAA7B,6BAA6B;kBADlD,SAAS;8BASC,QAAQ;sBAAhB,KAAK;gBACG,QAAQ;sBAAhB,KAAK;gBACG,qBAAqB;sBAA7B,KAAK;gBACG,qBAAqB;sBAA7B,KAAK","sourcesContent":["import { AfterContentInit, Directive, Input } from '@angular/core';\nimport { BufferGeometry, Material, Object3D } from 'three';\nimport { AnyConstructor, UnknownRecord } from '../typings';\nimport { ThreeObject3d } from './object-3d.abstract';\n\n@Directive()\nexport abstract class ThreeObject3dMaterialGeometry<\n    TObject extends Object3D = Object3D\n  >\n  extends ThreeObject3d<TObject>\n  implements AfterContentInit\n{\n  abstract get objectType(): AnyConstructor<TObject>;\n\n  @Input() geometry?: string | BufferGeometry | null;\n  @Input() material?: string | string[] | Material | Material[] | null;\n  @Input() morphTargetInfluences?: number[];\n  @Input() morphTargetDictionary?: { [key: string]: number };\n\n  private _objectMaterialGeometry!: TObject;\n\n  private _extraArgs?: unknown[];\n  set extraArgs(v: unknown[]) {\n    this._extraArgs = v;\n  }\n\n  ngAfterContentInit() {\n    this.init();\n  }\n\n  protected initObject() {\n    if (this.canCreate()) {\n      const material = this.getMaterial();\n      const geometry = this.getGeometry();\n\n      this._objectMaterialGeometry = new this.objectType(\n        geometry,\n        material,\n        ...(this._extraArgs || [])\n      );\n\n      if (\n        this.morphTargetDictionary &&\n        'morphTargetDictionary' in this._objectMaterialGeometry\n      ) {\n        (this._objectMaterialGeometry as UnknownRecord).morphTargetDictionary =\n          this.morphTargetDictionary;\n      }\n\n      if (\n        this.morphTargetInfluences &&\n        'morphTargetInfluences' in this._objectMaterialGeometry\n      ) {\n        (this._objectMaterialGeometry as UnknownRecord).morphTargetInfluences =\n          this.morphTargetInfluences;\n      }\n\n      if (this.customize) {\n        this.customize();\n      }\n    }\n  }\n\n  protected customize?: () => void;\n\n  protected canCreate() {\n    return true;\n  }\n\n  get object3d(): TObject {\n    return this._objectMaterialGeometry;\n  }\n\n  private getMaterial(): Material[] | Material | undefined {\n    if (this.material) {\n      if (\n        (Array.isArray(this.material) &&\n          this.material[0] instanceof Material) ||\n        this.material instanceof Material\n      ) {\n        return this.material as Material | Material[];\n      }\n\n      if (Array.isArray(this.material)) {\n        return (this.material as string[]).map(\n          (materialId) =>\n            this.instancesStore.getImperativeState().materials[materialId]\n        );\n      }\n\n      return this.instancesStore.getImperativeState().materials[this.material];\n    }\n\n    return undefined;\n  }\n\n  private getGeometry(): BufferGeometry | undefined {\n    if (this.geometry) {\n      if (this.geometry instanceof BufferGeometry) {\n        return this.geometry;\n      }\n\n      return this.instancesStore.getImperativeState().bufferGeometries[\n        this.geometry\n      ];\n    }\n    return undefined;\n  }\n}\n"]}