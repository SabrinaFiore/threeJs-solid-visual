{"version":3,"file":"interleaved-buffer-attribute.directive.js","sourceRoot":"","sources":["../../../../../../../packages/core/attributes/src/lib/interleaved-buffer-attribute/interleaved-buffer-attribute.directive.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,mBAAmB,EAAE,MAAM,qBAAqB,CAAC;AAC1D,OAAO,EACL,SAAS,EACT,KAAK,EACL,MAAM,EAIN,QAAQ,GACT,MAAM,eAAe,CAAC;AACvB,OAAO,EAA8B,0BAA0B,EAAE,MAAM,OAAO,CAAC;;;AAM/E,MAAM,OAAO,mCAAmC;IAY9C,YACqB,MAAc,EACF,iBAAuC;QADnD,WAAM,GAAN,MAAM,CAAQ;QACF,sBAAiB,GAAjB,iBAAiB,CAAsB;IACrE,CAAC;IAEJ,WAAW;QACT,IAAI,CAAC,MAAM,CAAC,iBAAiB,CAAC,GAAG,EAAE;YACjC,IAAI,IAAI,CAAC,SAAS,EAAE;gBAClB,IAAI,CAAC,SAAS,CAAC,WAAW,GAAG,IAAI,CAAC;aACnC;QACH,CAAC,CAAC,CAAC;IACL,CAAC;IAED,QAAQ;QACN,IAAI,CAAC,MAAM,CAAC,iBAAiB,CAAC,GAAG,EAAE;YACjC,IAAI,IAAI,CAAC,iBAAiB,IAAI,IAAI,CAAC,MAAM,EAAE;gBACzC,IAAI,CAAC,UAAU,GAAG,IAAI,0BAA0B,CAAC,GAAG,IAAI,CAAC,IAAI,CAAC,CAAC;gBAC/D,IAAI,IAAI,CAAC,SAAS,EAAE;oBAClB,IAAI,CAAC,iBAAiB,CAAC,cAAc,CAAC,YAAY,CAChD,IAAI,CAAC,MAAM,EACX,IAAI,CAAC,SAAS,CACf,CAAC;iBACH;aACF;QACH,CAAC,CAAC,CAAC;IACL,CAAC;IAED,WAAW;QACT,IAAI,CAAC,MAAM,CAAC,iBAAiB,CAAC,GAAG,EAAE;YACjC,IAAI,IAAI,CAAC,iBAAiB,IAAI,IAAI,CAAC,MAAM,EAAE;gBACzC,IAAI,CAAC,iBAAiB,CAAC,cAAc,CAAC,eAAe,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;aACpE;QACH,CAAC,CAAC,CAAC;IACL,CAAC;IAED,IAAI,SAAS;QACX,OAAO,IAAI,CAAC,UAAU,CAAC;IACzB,CAAC;;iIAjDU,mCAAmC;qHAAnC,mCAAmC;4FAAnC,mCAAmC;kBAJ/C,SAAS;mBAAC;oBACT,QAAQ,EAAE,kCAAkC;oBAC5C,QAAQ,EAAE,+BAA+B;iBAC1C;;0BAeI,QAAQ;4CAPF,IAAI;sBAAZ,KAAK;gBACG,MAAM;sBAAd,KAAK","sourcesContent":["import { ThreeBufferGeometry } from '@angular-three/core';\nimport {\n  Directive,\n  Input,\n  NgZone,\n  OnChanges,\n  OnDestroy,\n  OnInit,\n  Optional,\n} from '@angular/core';\nimport { BuiltinShaderAttributeName, InterleavedBufferAttribute } from 'three';\n\n@Directive({\n  selector: 'ngt-interleaved-buffer-attribute',\n  exportAs: 'ngtInterleavedBufferAttribute',\n})\nexport class InterleavedBufferAttributeDirective\n  implements OnChanges, OnInit, OnDestroy\n{\n  static ngAcceptInputType_args:\n    | ConstructorParameters<typeof InterleavedBufferAttribute>\n    | undefined;\n\n  @Input() args!: ConstructorParameters<typeof InterleavedBufferAttribute>;\n  @Input() attach?: BuiltinShaderAttributeName;\n\n  private _attribute?: InterleavedBufferAttribute;\n\n  constructor(\n    protected readonly ngZone: NgZone,\n    @Optional() protected readonly geometryDirective?: ThreeBufferGeometry\n  ) {}\n\n  ngOnChanges() {\n    this.ngZone.runOutsideAngular(() => {\n      if (this.attribute) {\n        this.attribute.needsUpdate = true;\n      }\n    });\n  }\n\n  ngOnInit() {\n    this.ngZone.runOutsideAngular(() => {\n      if (this.geometryDirective && this.attach) {\n        this._attribute = new InterleavedBufferAttribute(...this.args);\n        if (this.attribute) {\n          this.geometryDirective.bufferGeometry.setAttribute(\n            this.attach,\n            this.attribute\n          );\n        }\n      }\n    });\n  }\n\n  ngOnDestroy() {\n    this.ngZone.runOutsideAngular(() => {\n      if (this.geometryDirective && this.attach) {\n        this.geometryDirective.bufferGeometry.deleteAttribute(this.attach);\n      }\n    });\n  }\n\n  get attribute(): InterleavedBufferAttribute | undefined {\n    return this._attribute;\n  }\n}\n"]}